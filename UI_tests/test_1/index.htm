<!DOCTYPE html>
<html lang="fr">
  <head>

    <!--
    TODO:
      - Drag-n-drop d'un fichier => afficher ses caractéristiques ...

    -->

    <meta charset="utf-8">
    <title>Menu</title>

    <style>

      body {
        margin: 0;
        padding: 0;
        min-height: 100%;
        background-color: #81D4FA;
      }
      nav {
        background-color: #d32f2f;
        position: fixed;
        left: 0;
        top: 0;
        bottom:0;
        width: 15%;
        transition: 0.5s;
        user-select: none; /* Chrome ... */
      }

      /* menu diminué */
      nav.collapse {
        transition: 0.5s;
        width: 6%;
      }

      .menuItem {
        font-family: monospace;
        padding: 5px;
        width: 80%;
        height: 15px;
        margin: 5px 0; /* top/bottom left/right */
        text-align: center;
        font-size: 15pt;
        text-shadow: 0 0 5px orange;
      }
      .menuItem:hover {
        transition: all 0.5s; /* all = ? */
        font-size: calc(15pt + 5pt);
        text-decoration: underline;
        cursor: pointer;
      }
      nav.collapse > .menuItem > span > span {
        display: none;
        transition: 0.25s;
      }

      .menuItem > span {
        visibility: visible; /* pour bypasser le "hidden" ci-dessus */
      }

      #tool1::before {
        content: '\2660  '; /* BLACK SPADE SUIT */
      }
      #tool2::before {
        content: '\272A  '; /* CIRCLED WHITE STAR */
      }
      #tool3::before {
        content: '\273F  '; /* BLACK FLORETTE */
      }
      #tool4::before {
        content: '\262F  '; /* YIN YANG */
      }
      #tool5::before {
        content: '\2744  '; /* SNOWFLAKE */
      }
      #tool6::before {
        content: '\2708  '; /* AIRPLANE */
      }
      #tool7::before {
        content: '\2714  '; /* HEAVY CHECK MARK */
      }
      #tool8::before {
        content: '\1F382  '; /* BIRTHDAY CAKE */
      }

      #mainDiv {
        margin-left: 15%;
        width: calc(100% - 15%);
        height: 100%;
        transition: 0.5s;
        min-height: 100vh; /* 100% du viewport, nouveauté IE9+ */
      }
      #mainDiv:hover {
        transition: 0.5s;
        /*margin-left: 10%;*/
      }
      html {
        height: 100%;
      }
      article {
        width: 80%;
        margin: auto;
        margin-top: 25px;
      }

      #drop {
        min-height: 150px;
        width: 250px;
        border: 1px solid blue;
        margin: 10px;
        padding: 10px;
      }

      nav.collapse footer {
        transform: rotate(0deg);
        transition: 0.5s;
      }

      nav footer {
        position: absolute;
        bottom: 0;
        transition: 0.5s;
        margin: calc(50% - 48px / 2);
        width: 100%;
        height: 48px;
        transform-origin: 24px 24px;
        transform: rotate(-90deg);
        background-repeat: no-repeat;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABGUlEQVRoQ+2YSwrCQBBEnxvdiR5QPYCgIgheQUVEca839LN0JVkIEkw0PR0mI5V9V0+/mslU0iLxp5X4+tEAsR2UA3IgkIC2UCDA4PK8Ax1gDQyBXrC6r8AdOAML4PGSzg+wBya+fd3VDsC0aIBLA8nnCVyB/t8OsANm7qb7CmZrnBc50AZWwOjdJt/+ZrVs65yAZdkhNqvHKtRFFot80RmIvZ7K/bWFKiNzLviUhbbAAOg69wqV+ykLHYFxaKea60uz0K2B5CtloeQHSCFOf81Cm4Z+0CgL1fxyscnrJrZx86uSA34sbUrKQjZuQVXKQkH4HIpLf2wpCzkQLpJQFqoRrl1aN7GdnU+lHPDhaFeRA3Z2PpXJO/AEDAwwMek3d7wAAAAASUVORK5CYII=);
      }

      #tooltip {
        position: fixed;
        background-color: grey;
        color: white;
        display: none;
        z-index: 100;
        border: 1px solid red;
      }

    </style>
  </head>
  <body>



    <section id="mainContent">

      <!-- menu de gauche -->
      <nav>

        <!--- les menus sont injectés ici -->

        <footer>

        </footer>
      </nav>

      <!-- Panneau de droite -->
      <section id="mainDiv">
        <article>
          TEST !
        </article>

        <div id="drop">Déposer un fichier ici.</div>
        <div id="listOfFiles"></div>
        <span id="status"></span>
        <div id="myImages"></div>

      </section>

      <span id="tooltip"></span>

    </section>

    <script type="text/javascript">

      window.onload = init;

      /*
      .addEventListener() disponible depuis IE9, avant c'était .attachEvent() ...

      */

      function init() {

        // Gestion de la diminution/agrandissement du menu de gauche :
        document.body.addEventListener('mousemove', function(e) {
          var nav = document.getElementsByTagName('nav')[0];
          if(e.clientX > 300) {
            if(!nav.classList.contains('collapse')) {
              nav.classList.add('collapse');
            }
          }else{
            document.getElementsByTagName('nav')[0].classList.remove('collapse');
          }
        });


        // Ajout d'éléments dans ce menu
        var theMenus = [
          {
            title: 'Tool 1',
            description: 'une description __ 1'
          },
          {
            title: 'Tool 2',
            description: 'une description __ 2'
          },
          {
            title: 'Tool 3',
            description: 'une description __ 3'
          },
          {
            title: 'Tool 4',
            description: 'une description __ 4'
          },
          {
            title: 'Tool 5',
            description: 'une description __ 5'
          },
          {
            title: 'Tool 6',
            description: 'une description __ 6'
          },
          {
            title: 'Tool 7',
            description: 'une description __ 7'
          },
          {
            title: 'Tool 8',
            description: 'une description __ 8'
          },
        ];
        theMenus.reverse(); // reverse car .insertBefore() ci-dessous..

        //
        var nav = document.getElementsByTagName('nav')[0];
        for(var i = 0, l = theMenus.length; i < l; i++) {
          var m = theMenus[i];
          var div = document.createElement('div');
          div.className = 'menuItem';
          div.setAttribute('data-description', m.description);
          div.innerHTML = "<span id='tool"+(l-i)+"'><span>"+m.title+"</span></span>";
          nav.insertBefore(div, nav.firstChild);
        }

        // menu est de type "HTMLCollections" !!
        var menus = document.getElementsByClassName('menuItem');
        // HTMLCollections -> Array
        menus = [].slice.call(menus);

        // on ajoute l'écoute des évènements souris : mouseover/mouseout
        menus.forEach(function(el) {
          var desc = el.getAttribute('data-description');
          // Gestion du survol des menus :
          el.addEventListener('mouseover', function(e) {
            var tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = desc;
            tooltip.style.left = (e.clientX + 15) + 'px';
            tooltip.style.top = (e.clientY + 15) + 'px';
            tooltip.style.display = 'block';
          });
          el.addEventListener('mouseout', function(e) {
            // on masque le tooltip
            var tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = '';
            tooltip.style.display = 'none';
          });
          // ------
        });

        //
        // Gestion du glisser-déposer de fichiers :
        //

        var status = document.getElementById('status');
        if(window.FileReader) {
          status.innerHTML = 'Your browser support the HTML5 FileReader.';
          status.style.color = 'green';

          // Annulation d'un event => ??
          function cancel(e) {
            e.stopPropagation(); // = ?????
            if (e.preventDefault) { e.preventDefault(); }
            return false;
          }

          var listOfFiles = document.getElementById('listOfFiles');
          var drop = document.getElementById('drop');

          // pour autoriser le drag'n'drop ????
          drop.addEventListener('dragover', cancel); // on est sur une zone droppable ...
          drop.addEventListener('dragenter', cancel); // on entre sur une zone droppable ...

          drop.addEventListener('drop', function(e) {
            e = e || window.event; // IE ... ?
            e.preventDefault(); // pour que le navigateur n'ouvre pas le fichier déposé sur cette zone ... ?

            var dt = e.dataTransfer;
            console.log(dt);

            var files = dt.files;
            for(var i = 0; i<files.length; i++) {
              var file = files[i];

              // Uniquement les images sont acceptées
              var isImage = ['png', 'gif', 'bmp', 'jpg'/*, 'jpeg'*/].indexOf(file.name.substr(-3));
              if(isImage !== -1) {

                // les infos sur le fichier déposé !
                listOfFiles.innerHTML += [file.name, file.type, file.size].join(', ')+"<br/>";

                var reader = new FileReader();
                reader.addEventListener('loadend', function(e, file){
                  console.log(e, file);

                  // fin du chargement du fichier
                  listOfFiles.innerHTML += "[loaded]<br/>";

                  // contenu en base64
                  var base64Content = e.currentTarget.result;

                  // @TODO: Utiliser new Image(); ...
                  var img = document.createElement('img');
                  img.src = base64Content;
                  document.getElementById('myImages').appendChild(img);

                });
                // Lance le chargement du contenu du fichier !
                reader.readAsDataURL(file); // il existe aussi : readAsText, readAsBinaryString, readAsArrayBuffer

                console.log(reader);
              }
            }
            return false;
          });

        }else{ // IE8- ?
          status.innerHTML = 'Your browser does not support the HTML5 FileReader.';
          status.style.color = 'red';
        }

      } //init()

    </script>
  </body>
</html>
