<!DOCTYPE html>
<html>

  <!-- TODO :
    * Drag-n-Drop sur les sliders !! pour les intervertir
  -->

  <head>
    <meta charset="utf-8">
    <title>Slider</title>
    <style>

      body {
        background-color: rgba(0, 128, 255, 1);
      }

      #main {
        width: 40%;
        margin: auto;
        margin-top: 100px;

        padding: 20px;

         /* textes non sélectionnables */
        -ms-user-select: none; /* IE10+ / Edge */
        -webkit-user-select: none; /* Chrome */
        -moz-user-select: none; /* Firefox */
        user-select: none; /* Chrome 41+ */

        background-color: grey;
        opacity: 0.8;
        box-shadow: 2px 2px 5px black;

      }

      #sliders {
        margin: auto;
        width: 300px;
      }

      /* SLIDER Style ! */
      slider {
        padding: 1px;
        margin-bottom: 20px;

        /*permet au slider d'avoir la largeur de son contenu ?? */
        display: inline-block;

        /* http://stackoverflow.com/questions/14831866/breaking-to-a-new-line-with-inline-block */
        float: left;
        clear: left;

        /* http://stackoverflow.com/a/22758437 => pour la hauteur des éléments "relatifs" ?? */
        height: 0;
        overflow: visible;

        position: relative; /* pour que les 'position: absolute' "enfants" soient "relative" à cet element parent.. */
      }
        /* Le fond du slider */
      slider .mainBar {
        background-color: red;
        width: 100%;
        height: 4px;
      }
      slider .mainBar:hover {
        cursor: pointer;
      }
        /* La barre d'avancement */
      slider .currentBar {
        background-color: green;
        height: 2px;
        position: relative;
        top: -3px;
      }
        /* le selecteur */
      slider .grab {
        width: 8px;
        height: 8px;
        border-radius: 15px;
        background-color: blue;
        position: relative;
        top: -8px;
      }
      slider .grab:hover {
        cursor: pointer;
        border: 3px solid orange;
        margin-left: -3px;
        top: calc(-8px - 3px); /* IE9+ */
      }
        /* le text */
      slider .value {
        width: 100px;
        color: white;
        font-weight: 800;
        top: -14px;
        position: absolute;
        font-size: 8pt;
        font-family: monospace;
        cursor: default; /* pas de curseur "I" */
      }
      /* ------ */

      #buttons {
        display: block;
        width: 300px;
        margin: auto;
      }

      #buttons button {
        width: 90%;
      }

    </style>
  </head>
  <body>

    <div id="main">

      <div id="sliders">
        <!-- "custom tags" => /!\ avec IE 6-8, les "déclarer" avec un .createElement() ... -->
        <slider max=255
                current=0
                label="R">
        </slider>
        <slider max=255
                current=128
                label="G">
        </slider>
        <slider max=255
                current=255
                label="B">
        </slider>
      </div>

      <div style="clear: both;"></div>

      <div id="buttons">
        <button id="myButton">Aléatoire !</button>
      </div>
  </div>

    <!-- appelé à la fin quand le DOM est chargé -->
    <script type="text/javascript">
      // IIFE
      (function(w) {

        function Slider(tag) {

          var me = this;
          me.rootTag = tag;

          function init() {

            var max = me.rootTag.getAttribute('max') || 100;
            var current = me.rootTag.getAttribute('current') || 0;
            var suffix = me.rootTag.getAttribute('suffix') || '';

            // @TODO
            // pour le drag-n-drop : http://caniuse.com/#feat=dragndrop (IE/Edge : pas de .setDragImage() ???)
            // me.rootTag.draggable = true;

            // Le fond du slider
            var mainBar = document.createElement('div');
            mainBar.className = 'mainBar';
            if(max) { mainBar.style.width = max + 'px'; }
            me.rootTag.appendChild(mainBar);

            // L'état "d'avancement" courant
            var currentBar = document.createElement('div');
            currentBar.className = 'currentBar';
            currentBar.style.width = current + 'px';
            me.rootTag.appendChild(currentBar);

            // le truc pour modifier la valeur...
            var grab = document.createElement('div');
            grab.style.left = (current - 4) + 'px';
            grab.className = 'grab';
            me.rootTag.appendChild(grab);

            // Text ...
            var text = document.createElement('span');
            text.className = 'value';
            text.style.left = (current - 6) + 'px';
            text.innerHTML = current + suffix;
            me.rootTag.appendChild(text);


            // Début du drag-n-drop !
            /*
            // @TODO
            me.rootTag.addEventListener('dragstart', function(e) {
              // image vide lors du déplacement ...
              var dragImg = document.createElement('img');
              dragImg.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
              e.dataTransfer.setDragImage(dragImg, 0, 0); // image, xOffset, yOffset
            });
            */

            // on déplace le curseur
            function movingGrabber(e) {
              var pixels = e.pageX - me.rootTag.offsetLeft;
              if(pixels >= 0 && pixels <= max) {
                me.moveTo(pixels);
              }
            }

            // Gestion de la modification manuel du slider
              // quand on click sur le "grabber"
            grab.addEventListener('mousedown', function(e) {
              // on détecte les mouvements de souris
              document.body.addEventListener('mousemove', movingGrabber);
            });
            // dès qu'on relache la souris (où qu'on soit sur la page)
            document.body.addEventListener('mouseup', function(e) {
              // on n'écoute plus l'evenement mousemove sur le slider
              document.body.removeEventListener('mousemove', movingGrabber);
            });

            // simple click n'importe où sur le slider => change la valeur
            me.rootTag.addEventListener('click', function(e) {
              movingGrabber(e);
            });

            //
            me.mainBar = mainBar;
            me.currentBar = currentBar;
            me.grabber = grab;
            me.text = text;

            me.max = max;
            me.current = current;
            me.suffix = suffix;
          }

          me.moveTo = function(valueInPixel) {
            me.currentBar.style.width = valueInPixel + 'px';
            me.grabber.style.left = (valueInPixel - 4) + 'px';
            me.text.style.left = (valueInPixel - 6) + 'px';
            me.text.innerHTML = Math.round(valueInPixel) + me.suffix;
            me.current = valueInPixel;
            changeBackgroundColor();
          }

          // initialisation du slider
          init();

          return {
            moveTo: me.moveTo,
            getMax: function() {
              return me.max;
            },
            getValue: function() {
              return Math.round(me.current);
            }
          }
        }


        // on initialise tous les tags <slider>
        var slidersTags = document.getElementsByTagName('slider');
        w.sliders = []; // "global" : la liste de tous les sliders
        for(var i in slidersTags) {
          if(slidersTags[i].nodeType == 1) {
            w.sliders.push(new Slider(slidersTags[i]));
          }
        }

      })(window);

      // ajout de la fonctionnalité "random" sur le bouton "Aléatoire!"
      document.getElementById('myButton').addEventListener('click', function() {
        sliders.forEach(function(slider) {
          slider.moveTo(Math.random()*slider.getMax());
        });
      });


      function changeBackgroundColor() {
        var R = sliders[0].getValue();
        var G = sliders[1].getValue();
        var B = sliders[2].getValue();
        document.body.style.backgroundColor = 'rgba('+R+', '+G+', '+B+', 1)'; // rgba : IE9+
      }

    </script>
  </body>
</html>
